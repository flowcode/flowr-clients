{% extends "FlowerCoreBundle::layout.html.twig" %}

{% block title %}{{ '%entity% edit'|trans({'%entity%': 'Account'}, 'Account') }} - {{ parent() }}{% endblock %}

{% block body %}
    <section class="content">
        <div class="row">
            <div class="col-sm-8">
                {{ include("FlowerClientsBundle::appnav.html.twig", { 'app_account': true }) }} 
                <div class="box" id="showAccount">
                    <div class="box-header">
                        <h3 class="box-title">#{{ account.id }} {{ account.name|capitalize }}</h3>
                        {% if account.status and account.status.closed  %}
                            <h1>{{'Status'|trans({}, 'Account')}}: {{account.status}}</h1>
                        {% endif %}
                        <div class="box-tools">
                            {{ form_start(delete_form) }}
                            {{ form_widget(delete_form) }}
                            <div class="btn-group record_actions">
                                <button class="btn btn-link btn-sm" type="submit">{{ 'Delete'|trans({}, 'Account') }}</button>
                                <a class="btn btn-link  btn-sm" onclick="showEdit(true)">
                                    {{ 'Edit'|trans({}, 'Account') }}
                                </a>
                            </div>
                            <input name="modal" type="hidden" value="0">
                            {{ form_end(delete_form) }}
                            <div id="delete_confirm" class="modal fade">
                                <div class="modal-dialog">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                            <h3>{{ 'Confirm delete'|trans({}, 'Account') }}</h3>
                                        </div>
                                        <div class="modal-body">
                                            <p>{{ 'You are about to delete an item'|trans({}, 'Account') }}, {{ 'this procedure is irreversible'|trans({}, 'Account') }}.</p>
                                            <p>{{ 'Do you want to proceed?'|trans({}, 'Account') }}</p>
                                        </div>
                                        <div class="modal-footer">
                                            <button class="btn btn-danger">{{ 'Yes'|trans({}, 'Account') }}</button>
                                            <button class="btn btn-default" data-dismiss="modal">{{ 'No'|trans({}, 'Account') }}</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="box-body">
                        <table class="table table-hover record_properties">
                            <tbody>
                                <tr>
                                    <th scope="row">{{'Business name'|trans({}, 'Account')}}</th>
                                    <td>{{ account.businessName }}</td>
                                </tr>
                                <tr>
                                    <th scope="row">{{'CUIT/CUIL/DNI'|trans({}, 'Account')}}</th>
                                    <td>{{ account.cuit }}</td>
                                </tr>
                                <tr>
                                    <th scope="row">{{'Billing type'|trans({}, 'Account')}}</th>
                                    <td>{{ account.billingType |capitalize}}</td>
                                </tr>
                                <tr>
                                    <th scope="row">{{'Activity'|trans({}, 'Account')}}</th>
                                    <td>{{ account.activity |capitalize}}</td>
                                </tr>
                                <tr>
                                    <th scope="row">{{'Assignee'|trans({}, 'Account')}}</th>
                                    <td>{{ account.assignee |capitalize}}</td>
                                </tr>
                                <tr>
                                    <th scope="row">{{'Phone'|trans({}, 'Account')}}</th>
                                    <td>{{ account.phone }}</td>
                                </tr>
                                <tr>
                                    <th scope="row">{{'Address'|trans({}, 'Account')}}</th>
                                    <td>{{ account.address }}</td>
                                </tr>
                                <tr>
                                    <th scope="row">{{'Status'|trans({}, 'Account')}}</th>
                                    <td>{{ account.status |capitalize}}</td>
                                </tr>
                                <tr>
                                    <th scope="row">{{'Created'|trans({}, 'Account')}}</th>
                                    <td>{{ account.created | date("smallDate" | trans) |capitalize}}</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="box-footer">

                    </div>
                </div>
                <div class="box" id="editFormAccount"  style="display: none;">
                    <div class="box-header">
                        <div class="box-tools">
                            <div class="btn-group record_actions">
                                <a class="btn btn-link  btn-sm" onclick="showEdit(false)">
                                {{ 'Cancel'|trans({}, 'Account') }}
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="box-body">

                    {{ form_start(edit_form) }}
                        {{ form_widget(edit_form) }}
                        <p>
                            <button class="btn-default btn" type="submit"><i class="fa fa-edit"></i> {{ 'Save'|trans({}, 'Account') }}</button>
                        </p>
                    {{ form_end(edit_form) }}
                    </div>
                </div>
                <div class="box">
                    <div class="box-header">
                        <h3 class="box-title">{{ 'contacts'|trans|capitalize }}</h3>
                        <div class="box-tools">
                            <a class="btn btn-link" href="{{ path('contact_new_to_account', { id: account.id }) }}">
                                <i class="fa fa-plus"></i>
                            </a>
                        </div>
                    </div>
                    <div class="box-body">
                        <table class="table table-condensed">
                            <thead>
                                <tr>
                                    <th>{{ 'Name'|trans({}, 'Contact') }}</th>
                                    <th>{{ 'Email'|trans({}, 'Contact') }}</th>
                                    <th>{{ 'Observations'|trans({}, 'Contact') }}</th>
                                    <th>{{ 'Phone'|trans({}, 'Contact') }}</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for contact in paginator %}
                                    <tr>
                                        <td>
                                            <a href="{{ path('contact_show', {id: contact.id}) }}">{{ contact.happyname }} </a>
                                        </td>
                                        <td>
                                            {{ contact.email }}
                                        </td>
                                        <td>
                                            {{ contact.observations }}
                                        </td>
                                        <td>{{ contact.phone }}</td>
                                    </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
            <div class="col-sm-4">
                <div class="box">
                    <div class="box-header">
                         <a class="btn btn-link" style="padding-left: 0px;" href="{{ path('callevent') }}?accountFilter%5B%5D={{account.id}}"><h3 class="box-title">{{ 'calls'|trans|capitalize }}</h3></a>
                        <div class="box-tools">

                            <a class="btn btn-link" href="{{ path('callevent_new_account',{account:account.id}) }}">
                                <i class="fa fa-plus"></i>
                            </a>
                        </div>
                    </div>
                    <div class="box-body">
                        <ul class="products-list product-list-in-box">
                            {% for call in accauntcalls %}
                                <li class="item cursor-pointer" ng-repeat="item in notes.notes">
                                    <a class="product-title" href="{{path('callevent_show',{id:call.id})}}">
                                            {{call.subject}} <small class="text-muted pull-right"><i class="fa fa-calendar"></i> {{call.date| date("m/d/y")}}</small>
                                    </a>
                                    <span class="product-description">
                                        {{call.status}}
                                    </span>
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                    <div class="box-footer">
                    </div>
                </div>
                <div class="box">
                    <div class="box-header">
                        <h3 class="box-title">{{ 'boards'|trans|capitalize }}</h3>
                        <div class="box-tools">
                            <a class="btn btn-link" href="{{ path('board_new_to_account', { id: account.id }) }}">
                                <i class="fa fa-plus"></i>
                            </a>
                        </div>
                    </div>
                    <div class="box-body">
                        <ul>
                            {% for board in accountBoards %}
                                <li>
                                    <a class="" href="{{ path('board_show', {id:board.id}) }}">
                                        {{ board.name }}
                                    </a>
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                    <div class="box-footer">
                    </div>
                </div>
                <div class="box" multi-app="flowerNotes">
                    <div ng-view>

                    </div>
                </div>
                <div class="box box-solid">
                    <div class="box-header">
                        <h3 class="box-title">{{ 'current projects'|trans|capitalize }}</h3>
                        <div class="box-tools">
                        </div>
                    </div>
                    <div class="box-body">
                        <ul class="products-list product-list-in-box">
                            {% for project in currentProjects %}
                                <li class="item cursor-pointer">
                                    <a class="product-title" href="{{ path('project_show', {id:project.id}) }}">
                                        {{ project.name|capitalize }}
                                    </a>
                                    <span class="product-description">
                    				  	{{ project.description }}
                    				</span>
                                </li>
                            {% endfor %}
                        </ul>
                    </div>
                    <div class="box-footer">
                    </div>
                </div>
            </div>
        </div>


    </section>

{% endblock %}
{% block javascripts %}
    {{ parent() }}

    <script type="text/javascript">
        var accountId = "{{ account.id }}";
        var type = "account";
    </script>

    <script src="{{ asset('bundles/ivoryckeditor/ckeditor.js') }}"></script>

    <script src="{{ asset('bundles/flowermarketing/plugin/ng-ckeditor.js') }}"></script>
    <script src="{{ asset('bundles/flowercore/js/angular/notes/app-notes.js') }}" type="text/javascript"></script>
    <script src="{{ asset('bundles/flowercore/js/angular/notes/controller/notesController.js') }}" type="text/javascript"></script>
    <script type="text/javascript">
        function showEdit(show){
            if(show){
                $("#showAccount").hide();
                $("#editFormAccount").show();
            }else{
                $("#showAccount").show();
                $("#editFormAccount").hide();
            }
        }
        
    </script>
{% endblock %}